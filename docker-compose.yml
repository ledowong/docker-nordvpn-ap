version: "2"

services:
  # Noted that 'privileged: true' in your VPN config is needed for docker-ap to manipulate AP
  nordvpn:
    image: ghcr.io/bubuntux/nordvpn
    container_name: nordvpn
    environment:
      - TOKEN=...
      - CONNECT=Hong_Kong
      - TECHNOLOGY=NordLynx
    cap_add:
      - NET_ADMIN
      - NET_RAW
    privileged: true
    restart: unless-stopped
  docker-ap:
    build:
      context: docker-ap
      dockerfile: Dockerfile
    container_name: docker-ap
    image: docker-ap
    restart: unless-stopped
    privileged: true
    depends_on:
      - nordvpn
    network_mode: service:nordvpn
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /sys/fs/cgroup/systemd:/sys/fs/cgroup/systemd
    environment:
      - INTERFACE=wlan0
      - OUTGOINGS=nordlynx
      - CHANNEL=36
      - WPA_PASSPHRASE=passw0rd
      - SSID=docker-ap
      - DNS_ADDRESSES=103.86.96.100,103.86.99.100 # NordVPN DNSs
      - COUNTRY_CODE=GB